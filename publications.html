---
layout: default
title : Publications
navbar_name: Publications
body_attr: >-
  data-spy="scroll" data-target="#navbar-year" data-offset="100"
---

<blockquote>
  <p>
    <em>
      Here is a list of my first-author and corresponding-author peer-reviewed publications.
      A complete list is available on
      <a href="https://scholar.google.co.uk/citations?hl=en&user=Fdae-1AAAAAJ" target="_blank">
        <i class="fas fa-link"></i> Google Scholar
      </a>.
    </em>
  </p>
</blockquote>

{% assign pubs_by_year = site.publications
   | sort: "date" | reverse
   | group_by_exp: "item", "item.date | date: '%Y'" %}

<div class="row">
  <div class="col-12 col-lg-10">
    {% for year in pubs_by_year %}
    <!-- 用 section 包一层，便于设置滚动偏移和最后一节的底部留白 -->
    <section id="year-{{ year.name }}" class="year-section">
      <h2 class="pt-4">{{ year.name }}</h2>
      <div class="my-0 p-0 bg-white shadow-sm rounded-sm">
        {% for item in year.items %}
          {% include widgets/publication_item.html item=item %}
        {% endfor %}
      </div>
    </section>
    {% endfor %}

    <!-- 页面底部附加说明 / CTA 卡片 -->
    <div class="alert alert-light border mt-4">
      <p class="mb-2">
        Only first-author and corresponding-author publications are listed here.
        For a complete and up-to-date list, please visit
        <a href="https://scholar.google.co.uk/citations?hl=en&user=Fdae-1AAAAAJ" target="_blank">
          <i class="fas fa-link"></i> Google Scholar
        </a>.
      </p>
      <p class="mb-0">
        If you'd like a PDF of my full publication list or CV, feel free to
        <a href="mailto:yameili@email.swu.edu.cn">contact me</a>.
      </p>
    </div>
  </div>

  <div class="col-2 d-none d-lg-block">
    <nav id="navbar-year" class="nav nav-pills flex-column sticky-top" style="top: 80px">
      {% for year in pubs_by_year %}
      <a class="nav-link d-block" href="#year-{{ year.name }}">{{ year.name }}</a>
      {% endfor %}
    </nav>
  </div>
</div>

<style>
  /* 平滑滚动（浏览器级） */
  html { scroll-behavior: smooth; }

  /* 固定头部的锚点偏移（根据你的导航高度调整） */
  :root { --anchor-offset: 120px; }

  /* 让每个年份区块在滚动定位时留出头部空间 */
  .year-section {
    scroll-margin-top: var(--anchor-offset);
  }

  /* ✅ 给最后一个年份区块加足够的底部空间，避免“贴底点不动” */
  .year-section:last-of-type {
    padding-bottom: 40vh;
  }

  /* 侧边年份的激活态更明显（Bootstrap 的 .active 会生效，这里加粗） */
  #navbar-year .nav-link.active {
    font-weight: 700;
  }
</style>

<script>
(function(){
  const OFFSET = 120; // 与 CSS 中 --anchor-offset 保持一致
  const nav = document.getElementById('navbar-year');
  if (!nav) return;

  const links = Array.from(nav.querySelectorAll('a'));
  const sections = Array.from(document.querySelectorAll('.year-section'));

  // 点击期间是否锁定（不让 Observer 改高亮）
  let locked = false;
  let lockedHref = null;
  let unlockTimer = null;
  let scrollCheckBound = null;

  function setActiveHref(href){
    links.forEach(l => l.classList.toggle('active', l.getAttribute('href') === href));
  }

  // 判断目标 section 是否已经“到位”：标题在导航下方、内容有可见高度
  function sectionInPlace(sec){
    if (!sec) return false;
    const r = sec.getBoundingClientRect();
    const topOK = r.top <= OFFSET + 6;                  // 标题不被遮住
    const hasBody = r.bottom - (OFFSET + 6) > 120;      // 可见内容足够（避免下一节更占比）
    return topOK && hasBody;
  }

  // 尝试解锁：当目标年份真正到位时，解除锁定；同时兜底超时也会解锁
  function tryUnlock(){
    if (!locked || !lockedHref) return;
    const sec = document.querySelector(lockedHref);
    if (sectionInPlace(sec)){
      locked = false;
      setActiveHref(lockedHref); // 再确认一次高亮
      window.removeEventListener('scroll', scrollCheckBound, {passive:true});
      if (unlockTimer) clearTimeout(unlockTimer);
    }
  }

  // 点击：立即高亮 + 平滑滚动；上锁，直到目标就位再解锁
  links.forEach(a => {
    a.addEventListener('click', e => {
      e.preventDefault();
      const href = a.getAttribute('href');
      const target = document.querySelector(href);
      if (!target) return;

      // 立即高亮点击的年份
      setActiveHref(href);

      // 上锁，禁止 Observer 期间改高亮
      locked = true;
      lockedHref = href;
      if (unlockTimer) clearTimeout(unlockTimer);
      if (scrollCheckBound) window.removeEventListener('scroll', scrollCheckBound, {passive:true});

      // 计算位置并滚动（带头部偏移）
      let top = window.pageYOffset + target.getBoundingClientRect().top - OFFSET;
      const maxTop = document.documentElement.scrollHeight - window.innerHeight;
      top = Math.min(top, Math.max(0, maxTop - 1));
      window.scrollTo({ top, behavior: 'smooth' });

      // 滚动过程中持续检测是否“到位”，到位则解锁
      scrollCheckBound = () => tryUnlock();
      window.addEventListener('scroll', scrollCheckBound, {passive:true});

      // 兜底：1.5s 后强制解锁（应对图片加载导致布局抖动）
      unlockTimer = setTimeout(() => {
        locked = false;
        setActiveHref(href);
        window.removeEventListener('scroll', scrollCheckBound, {passive:true});
      }, 1500);
    });
  });

  // 滚动时自动高亮（仅当未上锁时生效）
  const observer = new IntersectionObserver((entries) => {
    if (locked) return; // 点击期间不改高亮，避免抖动

    // 选择当前“最可见”的年份区块
    const visible = entries
      .filter(e => e.isIntersecting)
      .sort((a, b) => b.intersectionRatio - a.intersectionRatio)[0];

    if (visible && visible.target) {
      setActiveHref('#' + visible.target.id);
    }
  }, {
    root: null,
    rootMargin: `-${OFFSET + 10}px 0px -60% 0px`,
    threshold: [0, 0.1, 0.25, 0.5, 0.75, 1]
  });

  sections.forEach(sec => observer.observe(sec));
})();
</script>

